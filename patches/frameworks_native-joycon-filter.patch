From 45af43c7e90992affc30b058690c4a544c243ba8 Mon Sep 17 00:00:00 2001
From: Thomas <halorocker89@gmail.com>
Date: Fri, 19 Feb 2021 08:37:50 -0500
Subject: [PATCH] joycon filter patch

Change-Id: I226f4d24a7d0cf894d0f3af1db5ccb44379a9fca
---
 services/inputflinger/reader/EventHub.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/services/inputflinger/reader/EventHub.cpp b/services/inputflinger/reader/EventHub.cpp
index a1514af66..730d71d93 100644
--- a/services/inputflinger/reader/EventHub.cpp
+++ b/services/inputflinger/reader/EventHub.cpp
@@ -1305,6 +1305,16 @@ status_t EventHub::openDeviceLocked(const char* devicePath) {
     // Load the configuration file for the device.
     loadConfigurationLocked(device);
 
+    bool deviceDisabled = false;
+    if (device->configuration && device->configuration->tryGetProperty(String8("device.disabled"), deviceDisabled)) {
+        if (deviceDisabled) {
+            delete device;
+            ALOGV("ignoring disabled device");
+            return -1;
+        }
+    }
+
+
     // Figure out the kinds of events the device reports.
     ioctl(fd, EVIOCGBIT(EV_KEY, sizeof(device->keyBitmask)), device->keyBitmask);
     ioctl(fd, EVIOCGBIT(EV_ABS, sizeof(device->absBitmask)), device->absBitmask);
-- 
2.27.0

